

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Reading Result Sets &mdash; ctds 1.14.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Transactions" href="transactions.html" />
    <link rel="prev" title="Calling Stored Procedures" href="callproc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ctds
          

          
          </a>

          
            
            
              <div class="version">
                1.14
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Basic Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="execute.html">Executing SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="callproc.html">Calling Stored Procedures</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reading Results</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fetching-rows">Fetching Rows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reading-columns">Reading Columns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advancing-the-result-set">Advancing the Result Set</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="bulk_insert.html">Bulk Insert</a></li>
<li class="toctree-l1"><a class="reference internal" href="pooling.html">Connection Pooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Change Log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ctds</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Reading Result Sets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/results.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="reading-result-sets">
<h1>Reading Result Sets<a class="headerlink" href="#reading-result-sets" title="Permalink to this headline">¶</a></h1>
<p><em>cTDS</em> supports reading multiple result sets generated by
<a class="reference internal" href="cursor.html#ctds.Cursor.execute" title="ctds.Cursor.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.execute()</span></code></a> or <a class="reference internal" href="cursor.html#ctds.Cursor.callproc" title="ctds.Cursor.callproc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.callproc()</span></code></a>.</p>
<p>Due to the design of the TDS protocol, it is recommended to read all rows of
all result set(s) as soon as possible to allow the database server to reclaim
resources associated with the result set(s).</p>
<div class="section" id="fetching-rows">
<h2>Fetching Rows<a class="headerlink" href="#fetching-rows" title="Permalink to this headline">¶</a></h2>
<p>Rows from the current result set can be read using any of
<a class="reference internal" href="cursor.html#ctds.Cursor.fetchone" title="ctds.Cursor.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchone()</span></code></a>, <a class="reference internal" href="cursor.html#ctds.Cursor.fetchmany" title="ctds.Cursor.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchmany()</span></code></a>, or
<a class="reference internal" href="cursor.html#ctds.Cursor.fetchall" title="ctds.Cursor.fetchall"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchall()</span></code></a> methods. <em>cTDS</em> will cache all retrieved raw
row data. However, to save memory, it is only converted to Python objects when
first accessed from the Python client. This is done to minimize memory overhead
when processing large result sets. Columns for the current resultset can be
retrieved using the <a class="reference internal" href="cursor.html#ctds.Cursor.description" title="ctds.Cursor.description"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ctds.Cursor.description</span></code></a> property.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ctds</span>
<span class="k">with</span> <span class="n">ctds</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">callproc</span><span class="p">(</span><span class="s1">&#39;GetSomeResults&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="c1"># Get column names.</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>

<span class="c1"># Process the rows after releasing the connection</span>
<span class="nb">print</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="c1"># Do stuff with the rows.</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
</pre></div>
</div>
<p>The row list returned from <a class="reference internal" href="cursor.html#ctds.Cursor.fetchmany" title="ctds.Cursor.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchmany()</span></code></a>, or
<a class="reference internal" href="cursor.html#ctds.Cursor.fetchall" title="ctds.Cursor.fetchall"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchall()</span></code></a> implements the Python sequence protocol and
therefore supports indexing. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ctds</span>
<span class="k">with</span> <span class="n">ctds</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">callproc</span><span class="p">(</span><span class="s1">&#39;GetSomeResults&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="c1"># Print the first column of row 5.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unless a result set contains a large number of rows, it is typically
recommended to use <a class="reference internal" href="cursor.html#ctds.Cursor.fetchall" title="ctds.Cursor.fetchall"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchall()</span></code></a> to retrieve all the
rows of a result. Only when result sets are sufficiently large as to make
caching them a large memory burden is it recommended to use
<a class="reference internal" href="cursor.html#ctds.Cursor.fetchone" title="ctds.Cursor.fetchone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchone()</span></code></a> or <a class="reference internal" href="cursor.html#ctds.Cursor.fetchmany" title="ctds.Cursor.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.fetchmany()</span></code></a>.</p>
</div>
<div class="section" id="reading-columns">
<h3>Reading Columns<a class="headerlink" href="#reading-columns" title="Permalink to this headline">¶</a></h3>
<p><em>cTDS</em> rows support referencing column values multiple ways: you can index
a row by either a column number or a column name, use a column name as an
attribute of the row, or build a dictionary mapping column names to values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ctds</span>
<span class="k">with</span> <span class="n">ctds</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            SELECT</span>
<span class="sd">                &#39;unnamed&#39;,</span>
<span class="sd">                2 AS Column2,</span>
<span class="sd">                &#39;Three&#39; AS Column3</span>
<span class="sd">            &#39;&#39;&#39;</span>
        <span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="c1"># index</span>
    <span class="k">assert</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unnamed&#39;</span>

    <span class="c1"># attribute</span>
    <span class="k">assert</span> <span class="n">row</span><span class="o">.</span><span class="n">Column2</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="c1"># mapping</span>
    <span class="k">assert</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Column3&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Three&#39;</span>

    <span class="c1"># dict - note that the column number is used as the key</span>
    <span class="c1"># for any unnamed columns</span>
    <span class="k">assert</span> <span class="n">row</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;unnamed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Column1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;Column2&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Column3&#39;</span><span class="p">:</span> <span class="s1">&#39;Three&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advancing-the-result-set">
<h2>Advancing the Result Set<a class="headerlink" href="#advancing-the-result-set" title="Permalink to this headline">¶</a></h2>
<p>The result set can be advanced using the <a class="reference internal" href="cursor.html#ctds.Cursor.nextset" title="ctds.Cursor.nextset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.nextset()</span></code></a>
method. New operations using <a class="reference internal" href="cursor.html#ctds.Cursor.execute" title="ctds.Cursor.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.execute()</span></code></a> or
<a class="reference internal" href="cursor.html#ctds.Cursor.callproc" title="ctds.Cursor.callproc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ctds.Cursor.callproc()</span></code></a> will discard any unread result sets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previous result sets cannot be retrieved once the cursor has been advanced
past them.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="transactions.html" class="btn btn-neutral float-right" title="Transactions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="callproc.html" class="btn btn-neutral float-left" title="Calling Stored Procedures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-, Zillow, Inc..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>