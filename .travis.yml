language: generic

matrix:
    include:
        - env: PYTHON_VERSION=3.6
          os: linux
          services: docker
          sudo: required
          after_script: docker stop ctds-unittest-sqlserver
        # Use generic language for osx
        - os: osx
          language: generic

# Travis-ci doesn't support Python on OS X. Install it manually for now.
before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install freetds; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install python3; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then virtualenv venv -p python3; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then source venv/bin/activate; fi

# Travis-ci doesn't support docker support on OS X. Just verify ctds builds on OS X.
install: if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install .; fi

script: if [[ "$TRAVIS_OS_NAME" != "osx" ]]; make check_${PYTHON_VERSION}; fi
